<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作品欣賞 | 聖衣神話</title>
    <!-- 引入 Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 FontAwesome 圖示 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        myth: {
                            dark: '#0f172a',
                            gold: '#fbbf24',
                            bronze: '#b45309',
                            panel: '#1e293b'
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Noto Serif TC"', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0f172a;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, transparent 70%);
            background-attachment: fixed;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 4px; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-gray-200 antialiased min-h-screen flex flex-col">

    <!-- 頂部導航列 -->
    <nav class="bg-myth-dark/80 backdrop-blur-md border-b border-myth-gold/20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-star text-myth-gold text-xl"></i>
                    <span class="font-serif text-xl font-bold tracking-widest text-white">聖衣神話 <span class="text-myth-gold">| 作品欣賞</span></span>
                </div>
                <a href="index.html" class="text-sm text-gray-400 hover:text-myth-gold transition-all">
                    <i class="fa-solid fa-arrow-left mr-1"></i> 返回首頁
                </a>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full flex flex-col lg:flex-row gap-8">
        
        <!-- 左側：控制面板 -->
        <aside class="w-full lg:w-1/3 flex-shrink-0">
            <div id="formContainer" class="bg-myth-panel rounded-2xl p-6 shadow-xl border border-gray-700/50 lg:sticky lg:top-24 transition-all duration-300">
                <h2 id="formTitle" class="text-xl font-serif font-bold text-myth-gold mb-6 border-b border-gray-700 pb-2">
                    <i class="fa-solid fa-camera-retro mr-2"></i>發布你的聖衣收藏
                </h2>
                
                <form id="uploadForm" class="space-y-5">
                    <input type="hidden" id="editingId" value="">

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">上傳照片</label>
                        <div class="relative flex items-center justify-center w-full">
                            <label for="imageInput" class="flex flex-col items-center justify-center w-full h-40 border-2 border-gray-600 border-dashed rounded-xl cursor-pointer bg-gray-800/50 hover:border-myth-gold transition-all group overflow-hidden">
                                <div id="previewPrompt" class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i class="fa-solid fa-image text-3xl text-gray-400 group-hover:text-myth-gold mb-3"></i>
                                    <p class="text-sm text-gray-400">點擊上傳或更換照片</p>
                                </div>
                                <img id="imagePreview" class="absolute inset-0 w-full h-full object-cover hidden" alt="預覽">
                            </label>
                            <input id="imageInput" type="file" class="hidden" accept="image/*" />
                        </div>
                    </div>

                    <div>
                        <label for="titleInput" class="block text-sm font-medium text-gray-300 mb-2">作品標題</label>
                        <input type="text" id="titleInput" required placeholder="作品名稱..." 
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-myth-gold focus:outline-none">
                    </div>

                    <div>
                        <label for="descInput" class="block text-sm font-medium text-gray-300 mb-2">描述</label>
                        <textarea id="descInput" rows="3" placeholder="說點什麼..." 
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-myth-gold focus:outline-none resize-none"></textarea>
                    </div>

                    <div class="flex flex-col gap-3">
                        <button type="submit" id="submitBtn" 
                            class="w-full bg-gradient-to-r from-myth-bronze to-myth-gold text-gray-900 font-bold py-3 rounded-lg shadow-lg hover:brightness-110 transition-all">
                            發布作品
                        </button>
                        <button type="button" id="cancelEditBtn" class="hidden w-full bg-gray-700 text-white py-2 rounded-lg hover:bg-gray-600 transition-all">
                            取消編輯
                        </button>
                    </div>
                </form>
            </div>
        </aside>

        <!-- 右側：展示區 -->
        <section class="w-full lg:w-2/3">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-serif text-white border-l-4 border-myth-gold pl-3">最新展示</h3>
                <span id="postCount" class="text-sm text-gray-400"></span>
            </div>
            
            <div id="galleryGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 由 JS 生成卡片 -->
            </div>
        </section>
    </main>

    <!-- Lightbox：大圖瀏覽模態框 (新增功能) -->
    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300 pointer-events-none">
        <button id="closeLightbox" class="absolute top-6 right-6 text-white text-3xl hover:text-myth-gold transition-colors z-50">
            <i class="fa-solid fa-xmark"></i>
        </button>
        <div class="max-w-5xl w-full flex flex-col items-center">
            <img id="lightboxImg" src="" alt="大圖瀏覽" class="max-h-[85vh] max-w-full rounded-lg shadow-2xl object-contain">
            <div class="mt-4 text-center">
                <h2 id="lightboxTitle" class="text-2xl font-bold text-myth-gold font-serif"></h2>
                <p id="lightboxDesc" class="text-gray-300 mt-2 text-sm max-w-2xl"></p>
            </div>
        </div>
    </div>

    <script>
        let galleryData = [
            {
                id: "init-1",
                title: "神聖衣 處女座 沙加",
                description: "這是最接近神的男人。金屬的光澤在暗燈下顯得特別莊嚴。",
                imageUrl: "https://images.unsplash.com/photo-1618331835717-801e976710b2?auto=format&fit=crop&q=80&w=800",
                timestamp: Date.now()
            }
        ];

        const form = document.getElementById('uploadForm');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewPrompt = document.getElementById('previewPrompt');
        const titleInput = document.getElementById('titleInput');
        const descInput = document.getElementById('descInput');
        const editingIdInput = document.getElementById('editingId');
        const submitBtn = document.getElementById('submitBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const formTitle = document.getElementById('formTitle');
        const galleryGrid = document.getElementById('galleryGrid');

        // Lightbox 元素
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const lightboxTitle = document.getElementById('lightboxTitle');
        const lightboxDesc = document.getElementById('lightboxDesc');
        const closeLightbox = document.getElementById('closeLightbox');

        function renderGallery() {
            galleryGrid.innerHTML = '';
            document.getElementById('postCount').textContent = `共 ${galleryData.length} 件作品`;

            [...galleryData].sort((a, b) => b.timestamp - a.timestamp).forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-myth-panel rounded-xl overflow-hidden shadow-lg border border-gray-700/50 hover:border-myth-gold/30 transition-all group fade-in flex flex-col';
                card.innerHTML = `
                    <div class="relative h-56 overflow-hidden bg-gray-900 cursor-zoom-in" onclick="openLightbox('${item.id}')">
                        <img src="${item.imageUrl}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <i class="fa-solid fa-magnifying-glass-plus text-white text-3xl"></i>
                        </div>
                        <div class="absolute top-2 right-2 flex gap-2" onclick="event.stopPropagation()">
                            <button onclick="startEdit('${item.id}')" class="bg-myth-dark/80 hover:bg-myth-gold text-white hover:text-gray-900 p-2 rounded-full backdrop-blur-md transition-all">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button onclick="deletePost('${item.id}')" class="bg-red-900/80 hover:bg-red-600 text-white p-2 rounded-full backdrop-blur-md transition-all">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-4 flex-grow">
                        <h4 class="font-bold text-white mb-1 group-hover:text-myth-gold transition-colors">${item.title}</h4>
                        <p class="text-xs text-gray-500 mb-2">${new Date(item.timestamp).toLocaleString()}</p>
                        <p class="text-sm text-gray-400 line-clamp-2">${item.description}</p>
                    </div>
                `;
                galleryGrid.appendChild(card);
            });
        }

        // Lightbox 操作 (新增)
        window.openLightbox = function(id) {
            const item = galleryData.find(d => d.id === id);
            if (!item) return;

            lightboxImg.src = item.imageUrl;
            lightboxTitle.textContent = item.title;
            lightboxDesc.textContent = item.description;

            lightbox.classList.remove('hidden', 'pointer-events-none');
            setTimeout(() => lightbox.classList.add('opacity-100'), 10);
            document.body.style.overflow = 'hidden'; // 禁止底層捲動
        };

        function closeLightboxFn() {
            lightbox.classList.remove('opacity-100');
            setTimeout(() => {
                lightbox.classList.add('hidden', 'pointer-events-none');
                document.body.style.overflow = '';
            }, 300);
        }

        closeLightbox.addEventListener('click', closeLightboxFn);
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) closeLightboxFn();
        });

        // 監聽 ESC 鍵
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeLightboxFn();
        });

        // 編輯邏輯
        window.startEdit = function(id) {
            const item = galleryData.find(d => d.id === id);
            if (!item) return;

            editingIdInput.value = id;
            titleInput.value = item.title;
            descInput.value = item.description;
            imagePreview.src = item.imageUrl;
            imagePreview.classList.remove('hidden');
            previewPrompt.classList.add('hidden');
            
            formTitle.innerHTML = '<i class="fa-solid fa-pen-to-square mr-2"></i>修改作品資料';
            submitBtn.textContent = '儲存修改';
            cancelEditBtn.classList.remove('hidden');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById('formContainer').classList.add('ring-2', 'ring-myth-gold');
        };

        cancelEditBtn.addEventListener('click', resetForm);

        function resetForm() {
            form.reset();
            editingIdInput.value = '';
            imagePreview.classList.add('hidden');
            previewPrompt.classList.remove('hidden');
            formTitle.innerHTML = '<i class="fa-solid fa-camera-retro mr-2"></i>發布你的聖衣收藏';
            submitBtn.textContent = '發布作品';
            cancelEditBtn.classList.add('hidden');
            document.getElementById('formContainer').classList.remove('ring-2', 'ring-myth-gold');
        }

        window.deletePost = function(id) {
            if (confirm('確定要刪除這件作品嗎？')) {
                galleryData = galleryData.filter(d => d.id !== id);
                renderGallery();
                if (editingIdInput.value === id) resetForm();
            }
        };

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                imagePreview.src = url;
                imagePreview.classList.remove('hidden');
                previewPrompt.classList.add('hidden');
            }
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const id = editingIdInput.value;
            const title = titleInput.value.trim();
            const desc = descInput.value.trim();
            const file = imageInput.files[0];

            if (id) {
                const index = galleryData.findIndex(d => d.id === id);
                if (index !== -1) {
                    galleryData[index].title = title;
                    galleryData[index].description = desc;
                    if (file) galleryData[index].imageUrl = URL.createObjectURL(file);
                    galleryData[index].timestamp = Date.now();
                }
            } else {
                if (!file) return alert('請上傳照片');
                galleryData.push({
                    id: Date.now().toString(),
                    title,
                    description: desc,
                    imageUrl: URL.createObjectURL(file),
                    timestamp: Date.now()
                });
            }
            resetForm();
            renderGallery();
        });

        renderGallery();
    </script>
</body>
</html>